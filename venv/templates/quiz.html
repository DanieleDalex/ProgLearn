<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Title</title>
</head>
<body>
<div id="container_quizs">

</div>
<button type=button id="button1" onclick="check_radio()">Check Answer</button>
<p id="message"></p>
<button type=button id="button2" onclick="show_question()">Next Question</button>

<script>
    var questions
    var questions_keys
    var questions_code_keys
    var answers
    var i=0
    var x=0
    var correct=0
    function callback(results) {
        console.log(results)
        questions = results["questions"]
        answers = results["answers"]
        console.log(questions)
        questions_keys = Object.keys(questions)
        show_question()
    }
    $(document).ready(function(){
        $.ajax({
            url: "http://127.0.0.1:5000/quiz_form",
            success: callback
        })
    })
    function show_question() {
            $("#message").hide()
            $("#button2").hide()
            $("#button1").show()
            $("#container_quizs").empty()
            if (i < questions_keys.length) {
                $("#container_quizs").append('<pre><code> "' + questions_keys[i] + '" </code></pre>')
                for (let j = 0; j < questions[questions_keys[i]].length; j++) {
                    $("#container_quizs").append('<input type="radio" class="radios" name="input" value="'+ questions[questions_keys[i]][j]+'"> "' + questions[questions_keys[i]][j] + '"')
                }
                i = i + 1
            }
            if (i > questions_keys.length)  {
                $("#message").text("Final score= " + correct)
                $("#message").show()
                $("#button1").text("Back to games")
            }


        }

    function check_radio(){
        if (i > questions_keys.length) {
            window.location.assign("{{url_for('games')}}")
            return
        }
        $("#message").show()
        if( $('input:radio', "#container_quizs").is(':checked')){
            let checked = $('input[name="input"]:checked').val()
            console.log(typeof(checked))
            if (answers[x]==checked){
                $("#message").text("Correct answer!")
                correct++
                $('input[name="input"]:checked').attr("id","cor")
                document.getElementById("cor").style.backgroundColor = "green"
                // QUA POI VA AGGIUNTO IL CSS PER EVIDENZIARE IN VERDE ECC..
            }
            else{
                $("#message").text("Wrong answer, the correct answer is : "+ answers[x])
                // QUA POI VA AGGIUNTO IL CSS PER EVIDENZIARE IN ROSSO LA RISPOSTA CORRETTA...
            }
            x=x+1
            $("#button1").hide()
            $("#button2").show()
        }
        else{
            $("#message").text("Choose an answer")
        }
        if (i == questions_keys.length) {
            $("#button2").text("SHOW SCORE")
            i++
        }
    }
</script>
</body>
</html>